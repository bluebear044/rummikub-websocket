<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>rummi</title>
	<!-- 초기화 -->
	<link rel="stylesheet" type="text/css" href="./css/basic.css">
	<!-- rummi css -->
	<link rel="stylesheet" type="text/css" href="./css/rummi.css">
	<script type="text/javascript" src="./js/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="./js/redips-drag-min.js"></script>
	<script type="text/javascript" src="./rummikub.js"></script>
  <script type="text/javascript" src="./constant.js"></script>
  <script type="text/javascript" src="./game.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {

      var ws = Game.webSocketConnect();
      ws.onmessage = function (event) {
        //console.log("message received : " + event.data);
        var responseObject = JSON.parse(event.data);

        //Command Controller
        if(responseObject.command == CMD.START) {

          //game.processStart(responseObject);

        }else if(responseObject.command == CMD.TURN) {

          //game.processTurn(responseObject);

        }else if(responseObject.command == CMD.EXIT) {

          //game.processExit(responseObject);

        }else if(responseObject.command == CMD.INFO) {

          //game.processInfo(responseObject, user);

        }else if(responseObject.command == CMD.PRIVATE_INFO) {

          //game.processPrivateInfo(responseObject, user);

        }else {

          var tableObj = JSON.parse(responseObject)

          for(var i=0; i<6; i++) {
            for(var j=0; j<15; j++) {
              Game.settingTileHtml("#gameBoard", "", i, j);
            }
          }

          for(var i=0; i<6; i++) {
            for(var j=0; j<15; j++) {
              var tile = tableObj[(i*15)+j];

              if(tile != null) {
                Game.settingTile("#gameBoard", tile, i, j);
              }
              
            }
          }

          REDIPS.drag.init();          

        }
        
      }

      Game.makeBoard("#gameBoard", 15, 6);
      Game.makeBoard("#ownBoard", 15, 2);

      //setting tiles
      var tile1 = new Tile("1", "red", false);
      Game.settingTile("#gameBoard", tile1, 1, 2);

      var tile2 = new Tile("30", "red", true);
      Game.settingTile("#gameBoard", tile2, 1, 3);

      var tile3 = new Tile("3", "red", false);
      Game.settingTile("#gameBoard", tile3, 1, 4);

      var tile4 = new Tile("11", "blue", false);
      Game.settingTile("#gameBoard", tile4, 2, 6);

      var tile5 = new Tile("12", "yellow", false);
      Game.settingTile("#gameBoard", tile5, 2, 8);

      var tile6 = new Tile("5", "black", false);
      Game.settingTile("#gameBoard", tile6, 2, 9);

      //REDIPS Initialize
      REDIPS.drag.init();
      REDIPS.drag.dropMode = 'single';
      REDIPS.drag.event.dropped = function () {
        var boardSerializeMap = Game.serializeTable("#gameBoard");
        //console.log(JSON.stringify(boardSerializeMap));
        ws.send(JSON.stringify(boardSerializeMap));
      };

		});
	</script>
</head>
<body>

  <div id="redips-drag">
    <div id="wrap">
			<table class="board" id="gameBoard"></table>
			<table class="board" id="ownBoard"></table>
		</div>
	</div>

</body>
</html>