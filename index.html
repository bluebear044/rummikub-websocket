<html>
  <head>

    <link rel="stylesheet" href="rummikub.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="rummikub.js"></script>
    <script src="game.js"></script>
    <script src="constant.js"></script>

    <script>
      // static user info
      var user = {};

      $( document ).ready(function() {
          console.log( "ready!" );

          var host = location.origin.replace(/^http/, 'ws')
          //var host = "ws://desolate-wave-36629.herokuapp.com/";
          //var host = "ws://127.0.0.1:5000";
          
          //Websocket Instance
          var ws = new WebSocket(host);

          //Game Instance
          var game = new Game();

          $( "#sendBtn" ).click(function() {
            game.sendMessage(ws);
          });

          //keyboard
          $( "#msg" ).keypress(function(e) {
            if(e.keyCode == 13) {
              game.sendMessage(ws);
            }
          });

          $( "#startBtn" ).click(function() {
            game.startGame(ws);
          });

          $( "#turnBtn" ).click(function() {
            game.nextTurn(ws);
          });

          $( "#exitBtn" ).click(function() {
            game.exitGame(ws);
          });

          //onmessage
          ws.onmessage = function (event) {

            console.log("message received : " + event.data);
            var responseObject = JSON.parse(event.data);
            
            if(responseObject.command == CMD.START) {
              game.processStart(responseObject);
            }else if(responseObject.command == CMD.TURN) {
              game.processTurn(responseObject);
            }else if(responseObject.command == CMD.EXIT) {
              game.processExit(responseObject);
            }else if(responseObject.command == CMD.INFO) {
              game.processInfo(responseObject, user);
            }else if(responseObject.command == CMD.PRIVATE_INFO) {
              game.processPrivateInfo(responseObject, user);
            }else {
              game.processChat(event);
            }
          
          };

      });
    </script>
  </head>
  <body>
    <h1>Rummikub Online</h1>
    <p id="connectCount" />
    <p id="gamePlaying" />
    <p id="turnCount" />
    <p id="myInfo" />

    <div id="contents">
      <div id="nav">
        <ul id="chats">
        </ul>

        <input type="text" id="msg" />
        <input id="sendBtn" type="button" value="send" />
        <input id="startBtn" type="button" value="start" disabled="true" />
        <input id="turnBtn" type="button" value="turn" disabled="true" />
        <input id="exitBtn" type="button" value="exit" disabled="true" />
      </div>
    </div>

    <div id="board"></div>
    <div id="own"></div>

  </body>
</html>
