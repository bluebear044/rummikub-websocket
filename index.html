<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<title>rummi</title>
  <!-- Pure CSS -->
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
	<!-- 초기화 -->
	<link rel="stylesheet" type="text/css" href="./css/basic.css">
	<!-- rummi css -->
	<link rel="stylesheet" type="text/css" href="./css/rummi.css">
	<script type="text/javascript" src="./js/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="./js/redips-drag-min.js"></script>
	<script type="text/javascript" src="./rummikub.js"></script>
  <script type="text/javascript" src="./constant.js"></script>
  <script type="text/javascript" src="./game.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {

      var ws = Game.webSocketConnect();
      ws.onmessage = function (event) {
        console.log("message received : " + event.data);
        var responseObject = JSON.parse(event.data);

        //Command Controller
        if(responseObject.command == CMD.START) {

          //game.processStart(responseObject);

        }else if(responseObject.command == CMD.TURN) {

          //game.processTurn(responseObject);

        }else if(responseObject.command == CMD.EXIT) {

          //game.processExit(responseObject);

        }else if(responseObject.command == CMD.INFO) {

          //game.processInfo(responseObject, user);

        }else if(responseObject.command == CMD.PRIVATE_INFO) {

          //game.processPrivateInfo(responseObject, user);

        }else if(responseObject.command == CMD.SYNC) {
          
          var tableObj = responseObject.param;

          for(var i=0; i<6; i++) {
            for(var j=0; j<15; j++) {
              Game.settingTileHtml("#gameBoard", "", i, j);
            }
          }

          for(var i=0; i<6; i++) {
            for(var j=0; j<15; j++) {
              var tile = tableObj[(i*15)+j];

              if(tile != null) {
                Game.settingTile("#gameBoard", tile, i, j);
              }
              
            }
          }

          Redips.refresh();  

        }else {

          //todo chat

        }
        
      }

      //Initialize Board
      Game.makeBoard("#gameBoard", 15, 6);
      Game.makeBoard("#ownBoard", 15, 2);

      //Setting Intro Tiles
      Game.introSetting();

      //REDIPS Initialize
      Redips.initialize(ws);

		});
	</script>
</head>
<body>

  <div class="menu">
    <input id="name" type="text" placeholder="아이디">
    <button type="submit" class="pure-button pure-button-primary">접속</button>
    <button class="pure-button">게임시작</button>
    <button class="pure-button">턴종료</button>
  </div>
  
  <div id="redips-drag">
    <div id="wrap">
			<table class="board" id="gameBoard"></table>
			<table class="board" id="ownBoard"></table>
		</div>
	</div>

</body>
</html>